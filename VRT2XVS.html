<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="author" content="J1Mtonic">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>VRT to XVS</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>

</head>
<body>
    <form>
        <p>
            <label>Address: <input type="text" autocomplete="on" id="accountAddress" /></label>
            <button type="button" onclick="javascript:getTotalSupply()">Search</button>
        </p>
        <p>
            <label>Vested XVS Balance: </label>
            <label id="vestedXVSBalance"></label>
        </p>
        <p>
            <label>Withdrawable XVS Amount: </label>
            <label id="withdrawableXVSAmount"></label>
        </p>
        <p>
            <label>Generating XVS/day: </label>
            <label id="GeneratingXVSday"></label>
        </p>
    </form>
    <script type="text/javascript">
        async function getTotalSupply() {
            const provider = new Web3.providers.HttpProvider("https://bsc-dataseed.binance.org");
            const getBep20Abi = "https://api.bscscan.com/api?module=contract&action=getabi&address=";
            const bscscanAPI = "&apikey=J5HERDUSE8HWU7HISSURZY1349VBWHX31F";
            const contractXVSVesting = "0xa9dd0536ab0699d60c28ce369ff366a1e621bff1";
            const contractXVSVestingProxy = "0xb28dec7c7ac80f4d0b6a1b711c39e444cde8b2ce";
            const accountAddress = document.getElementById("accountAddress").value;
            const web3 = new Web3(provider);
            let decimals = 0;
            let XVSwithdrawableAmount = 0;
            let XVSvestings = 0;
            let XVSamount = 0;
            let XVSwithdrawnAmount = 0;
            let startTime = 0;
            let i = 0;
            try {
                let XVSVestingAbi = await fetch(getBep20Abi + contractXVSVesting + bscscanAPI).then(response => response.json()).then(data => {
                    return JSON.parse(data.result);
                });
                const myXVSVestingProxy = new web3.eth.Contract(XVSVestingAbi, contractXVSVestingProxy);
                decimals = await myXVSVestingProxy.methods.xvsDecimalsMultiplier().call();
                XVSwithdrawableAmount = await myXVSVestingProxy.methods.getWithdrawableAmount(accountAddress).call();
                let currentTime = await myXVSVestingProxy.methods.getCurrentTime().call();
                let totalVestingTime = await myXVSVestingProxy.methods.TOTAL_VESTING_TIME().call();                
                while (true) {
                    XVSvestings = await myXVSVestingProxy.methods.vestings(accountAddress, i++).call();
                    startTime = Number(XVSvestings.startTime);
                    if ((startTime + Number(totalVestingTime)) > Number(currentTime))
                    {
                        XVSamount += Number(XVSvestings.amount);
                        XVSwithdrawnAmount += Number(XVSvestings.withdrawnAmount);
                    }
                }
            } catch (err) { }
            document.getElementById("vestedXVSBalance").innerHTML = (XVSamount - XVSwithdrawnAmount) / decimals;
            document.getElementById("withdrawableXVSAmount").innerHTML = XVSwithdrawableAmount.totalWithdrawableAmount / decimals;
            document.getElementById("GeneratingXVSday").innerHTML = XVSamount / (365 * decimals);
        }
    </script>
</body>
</html>