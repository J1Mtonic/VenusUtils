<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="author" content="J1Mtonic">
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>XVS Votes</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
</head>
<body>
    <form>
        <p>
            <label>Address: <input type="text" autocomplete="on" id="accountAddress" /></label>
        </p>
        <p>
            <label>Block Number: <input type="text" autocomplete="on" placeholder="latest" id="blockNumber" /></label>
        </p>
        <p>
            <button type="button" onclick="javascript:getXVSvotes()">Search</button>
        </p>
        <p>
            <label>XVS Votes: </label>
            <label id="XVSVotes"></label>
        </p>
    <script type="text/javascript">
        async function getXVSvotes() {
            const provider = new Web3.providers.HttpProvider("https://bsc-dataseed.binance.org");
            const getBep20Abi = "https://api.bscscan.com/api?module=contract&action=getabi&address=";
            const bscscanAPI = "&apikey=J5HERDUSE8HWU7HISSURZY1349VBWHX31F";
            const contractXVSVault = "0xa0c958ca0ffa25253de0a23f98ad3062f3987073";
            const contractXVSVaultProxy = "0x051100480289e704d20e9DB4804837068f3f9204";
            const accountAddress = document.getElementById("accountAddress").value;
            const blockNumber = document.getElementById("blockNumber").value;
            const web3 = new Web3(provider);
            let decimals = 1000000000000000000;
            let XVSvotes = 0;
            try {
                let XVSVaultAbi = await fetch(getBep20Abi + contractXVSVault + bscscanAPI).then(response => response.json()).then(data => {
                    return JSON.parse(data.result);
                });
                const myXVSVaultProxy = new web3.eth.Contract(XVSVaultAbi, contractXVSVaultProxy);
                if (blockNumber == '') {
                    XVSvotes =  await myXVSVaultProxy.methods.getCurrentVotes(accountAddress).call();
                }
                else {
                    XVSvotes = await myXVSVaultProxy.methods.getPriorVotes(accountAddress, blockNumber).call();
                }
            } catch (err) { }
            document.getElementById("XVSVotes").innerHTML = XVSvotes / decimals;
        }
    </script>
</body>
</html>